<!DOCTYPE html>
<html lang="de">
<head>
        <meta charset="utf-8" />
        <title>aurka.com - uberspace</title>
        <link rel="stylesheet" href="http://aurka.com/theme/css/main.css" />
        <link href="http://aurka.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="aurka.com Atom Feed" />
        <link href="http://aurka.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="aurka.com RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://aurka.com/">aurka.com  <strong>under heavy development</strong></a></h1>
                <nav><ul>
                    <li><a href="http://aurka.com">Home</a></li>
                    <li><a href="http://mediagoblin.aurka.com/mediagoblin/mg.fcgi/u/janssen/">Bilder / Mediagoblin</a></li>
                    <li><a href="http://aurka.com/pages/fotografie.html">Fotografie</a></li>
                    <li><a href="http://aurka.com/category/tech.html">Tech-Posts</a></li>
                    <li><a href="http://aurka.com/pages/about.html">About</a></li>
                    <li><a href="http://aurka.com/pages/links.html">Links</a></li>
                </ul></nav>

        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://aurka.com/mediagoblin-auf-uberspace.html">Mediagoblin auf einem Uberspace</a></h1>
<footer class="post-info">
	Datum: 19.11.2013 |
        <!-- <abbr class="published" title="2013-11-19T00:00:00">
                19.11.2013
        </abbr> 

        <address class="vcard author">
                By <a class="url fn" href="http://aurka.com/author/janssen.html">janssen</a>
        </address>
 -->

Tags: <a href="http://aurka.com/tag/mediagoblin.html">mediagoblin</a>,<a href="http://aurka.com/tag/uberspace.html">uberspace</a>,<a href="http://aurka.com/tag/install.html">install</a>,<a href="http://aurka.com/tag/deploy.html">deploy</a>,<a href="http://aurka.com/tag/howto.html">howto</a>,<a href="http://aurka.com/tag/tech.html">tech</a>,<a href="http://aurka.com/tag/python.html">python</a>,<a href="http://aurka.com/tag/pypi.html">pypi</a>,<a href="http://aurka.com/tag/pip.html">pip</a>,<a href="http://aurka.com/tag/easy_install.html">easy_install</a>,<a href="http://aurka.com/tag/photo.html">photo</a>,<a href="http://aurka.com/tag/pictures.html">pictures</a>,</footer><!-- /.post-info --><p><img alt="Mediagoblin" src="http://www.aurka.com/pictures/mediagoblin_header.png" /></p>
<p>Bei den <a href="https://uberspace.de" title="Uberspace.de">Ubernauten</a> lässt sich <a href="http://www.mediagoblin.org/" title="Mediagoblin.org">Mediagoblin</a> installieren - auch wenn es doch ziemlich viel gebastel ist. Ich hoffe ich kann jemandem mit dieser Anleitung ein paar Minuten/Stunden Arbeit ersparen.</p>
<h1>Über Mediagoblin</h1>
<p>Mediagoblin ist ein in Python geschrieben und ein unter AGPL stehendes Replacement für Fotoplattformen wie flickr oder 500px und/oder für Musikplattforen wie Soundcloud. Es kann gar 3D-Dokument darstellen oder Filme abspielen. Kurz: Ein kleines Mediacenter.</p>
<h1>Installation</h1>
<h2>Vorbereitungen</h2>
<p>Diese Anleitung verwendet Postgres als Datenbank für Mediagoblin. Defaultmässig wird auf Sqlite zurückgegriffen - wenn ihr ohne Postgres auskommen wollt, dann vergesst diesen Punkt.</p>
<p>Wir müssen also zuerst postgres für den Uberspace konfigurieren. Hierfür muss nur ein Script angekickt werden:
    uberspace-setup-postgresql</p>
<p>User erstellen:</p>
<div class="highlight"><pre><span class="n">createuser</span> <span class="n">mediagoblin</span>
</pre></div>


<p>Datenbank erstellen (mit dem Owner des soeben erstellen Users ’mediagoblin’:</p>
<div class="highlight"><pre><span class="n">createdb</span> <span class="o">-</span><span class="n">E</span> <span class="n">UNICODE</span> <span class="o">-</span><span class="n">O</span> <span class="n">mediagoblin</span> <span class="n">mediagoblin</span>
</pre></div>


<p>Nun müsst ihr euch überlegen, wie ihr auf euer Mediagoblin zugreiffen wollt. Ich mache dies via Subdomain mediagoblin.aurka.com.
Also muss unter <code>/var/www/virtual/&lt;Uberspace Account&gt;/</code> ein Directory mit dem Namen <code>mediagoblin.aurka.com</code> erstellt werden.
Da Mediagoblin wie <code>git</code> gepullt wird, lasse ich gerade <code>git</code> den Ordner erstellen:</p>
<div class="highlight"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">virtual</span><span class="o">/&lt;</span><span class="n">Uberspace</span> <span class="n">Account</span><span class="o">&gt;</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="o">:</span><span class="c1">//gitorious.org/mediagoblin/mediagoblin.git mediagoblin.aurka.com</span>
<span class="n">cd</span> <span class="n">mediagoblin</span><span class="p">.</span><span class="n">aurka</span><span class="p">.</span><span class="n">com</span>
<span class="n">git</span> <span class="n">submodule</span> <span class="n">init</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span>
</pre></div>


<p>Das <code>git</code>-Repository ist momentan auf dem master-branch. Mit diesem habe ich nie eine laufende Version hingekriegt. Allgemein macht es Sinn, auf den aktuellesten Tag zu wechseln - mit diesem dürfte Mediagoblin am stabilsten laufen. In meinem Falle ist dies Tag v0.5.1.</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">checkout</span> <span class="n">v0</span><span class="mf">.5.1</span>
</pre></div>


<p>Nun wird mit <code>virtualenv</code> eine virtuelle Python Umgebung erstellt:</p>
<div class="highlight"><pre><span class="n">virtualenv</span> <span class="o">-</span><span class="n">p</span> <span class="n">python2</span><span class="mf">.7</span> <span class="o">--</span><span class="n">system</span><span class="o">-</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">.</span>
</pre></div>


<p>Diese virtuelle Umgebung muss nun aktiviert werden:</p>
<div class="highlight"><pre><span class="n">source</span> <span class="n">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>


<p>Jetzt verfügen wir über eine eigene virtuelle Python-Umgebung, fügen wir nun also die benötigten Pys hinzu. Ich verwende hierzu <code>pip</code>, natürlich kann auch <code>easy_install</code> verwendet werden:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">lxml</span>
<span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">psycopg2</span>
<span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">paste</span>
<span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">flup</span>
<span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">sqlalchemy</span>
</pre></div>


<p>Mediagoblin benötigt zusätzlich die Python Image Library (PIL). Dort gibt es jedoch etwas handarbeit, deshalb wird es nicht via Paketmanager installiert:
Aktuellste PIL Version von der <a href="http://www.pythonware.com/products/pil/" title="PIL Homepage">PIL-Homepage</a> herunterladen.</p>
<div class="highlight"><pre><span class="n">mkdir</span> <span class="n">PIL</span>
<span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//effbot.org/downloads/Imaging-1.1.7.tar.gz</span>
<span class="n">tar</span> <span class="n">xvfz</span> <span class="n">Imaging</span><span class="o">-</span><span class="mf">1.1.7</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">Imaging</span><span class="o">-</span><span class="mf">1.1.7</span>
</pre></div>


<p>PIL sollte die JPG, TIFF, etc. Libraries eigentlich automatisch finden - tut es aber nicht. In der setup.py können wir dies nun aber ändern:
<code>vim setup.py</code> -&gt; Die Nummern sind die Zeilennummern, damit ihr nicht lange suchen müsst ;-)</p>
<div class="highlight"><pre><span class="mi">36</span> <span class="n">TCL_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span> 
<span class="mi">37</span> <span class="n">JPEG_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span>
<span class="mi">38</span> <span class="n">ZLIB_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span>
<span class="mi">39</span> <span class="n">TIFF_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span>
<span class="mi">40</span> <span class="n">FREETYPE_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span>
<span class="mi">41</span> <span class="n">LCMS_ROOT</span> <span class="o">=</span> <span class="s">&quot;/usr/lib64&quot;</span>
</pre></div>


<p>(Der Vollständigkeitshalber wieder ins virtualevn-root wechseln <code>cd ../..</code>)</p>
<p>Nun kann PIL installiert werden:</p>
<div class="highlight"><pre><span class="cp">../../bin/python setup.py install</span>
</pre></div>


<p>Jetzt sind alle Pys, welche Mediagoblin nicht automatisch mitinstalliert (wieso auch immer) auf dem System. Nun kann der ganze Rest automatisch gezogen werden:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>


<p>Dies sollte ohne Fehler ablaufen. Ansonsten müsst ihr evt. noch weiter Pys installieren.</p>
<p>mediagoblin.ini muss nun noch angepasst werden. Die Verwendung von Postgres ist bereits vorbereitet - es muss nur diese Line entkommentiert werden.</p>
<div class="highlight"><pre><span class="n">sql_engine</span> <span class="o">=</span> <span class="n">postgresql</span><span class="o">:</span><span class="c1">///mediagoblin</span>
</pre></div>


<p>Nun kann die Datenbank initialisiert werden:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gmg</span> <span class="n">dbupdate</span>
</pre></div>


<p>Mediagoblin kann nun über den von den Ubernauten für euch freigegeben Port erreichbar gemacht werden. Zuerst muss der Port jedoch noch in der Datei <code>paste.ini</code> editiert werden:</p>
<div class="highlight"><pre><span class="k">[server:broadcast]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:Paste#http</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">0.0.0.0</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">&lt;insert-your-port-here&gt;</span>
</pre></div>


<p>Mediagoblin deployen:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">lazyserver</span><span class="p">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">server</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">broadcast</span>
</pre></div>


<p>Ihr könnt nun euer Mediagoblin unter http://<dein-uberspace>:<dein-port> ansteuern und verwenden.</p>
<h2>FastCGI deployment</h2>
<p>Soweit so gut, wir wollen aber via Port 80 und/oder Port 443 auf Mediagoblin zugreiffen. Also muss ein FastCGI deployment her.</p>
<p>Erstellt under <code>mediagoblin</code> die Datei <code>mg.fcgi</code> (Achtung: Die Pfäde zu Python und paste.ini korrigieren!):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="err">#</span> <span class="n">Written</span> <span class="k">in</span> <span class="mi">2011</span> <span class="k">by</span> <span class="nx">Christopher</span> <span class="nx">Allan</span> <span class="nx">Webber</span>
<span class="err">#</span>
<span class="err">#</span> <span class="k">To</span> <span class="nx">the</span> <span class="nx">extent</span> <span class="nx">possible</span> <span class="nx">under</span> <span class="nx">law</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">author</span><span class="p">(</span><span class="nb">s</span><span class="p">)</span> <span class="nx">have</span> <span class="nx">dedicated</span> <span class="kc">all</span>
<span class="err">#</span> <span class="nx">copyright</span> <span class="ow">and</span> <span class="nx">related</span> <span class="ow">and</span> <span class="nx">neighboring</span> <span class="nx">rights</span> <span class="k">to</span> <span class="nx">this</span> <span class="nx">software</span> <span class="k">to</span> <span class="nx">the</span>
<span class="err">#</span> <span class="k">public</span> <span class="nf">domain</span> <span class="nx">worldwide.</span> <span class="nx">This</span> <span class="nx">software</span> <span class="nx">is</span> <span class="nx">distributed</span> <span class="nx">without</span> <span class="nb">any</span>
<span class="err">#</span> <span class="nx">warranty.</span>
<span class="err">#</span> 
<span class="err">#</span> <span class="nx">You</span> <span class="nx">should</span> <span class="nx">have</span> <span class="nx">received</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">CC0</span> <span class="k">Public</span> <span class="nf">Domain</span> <span class="nx">Dedication</span> <span class="nx">along</span>
<span class="err">#</span> <span class="k">with</span> <span class="nx">this</span> <span class="nx">software.</span> <span class="k">If</span> <span class="ow">not</span><span class="p">,</span> <span class="nx">see</span>
<span class="err">#</span> <span class="o">&lt;</span><span class="nx">http</span><span class="p">:</span><span class="c1">//creativecommons.org/publicdomain/zero/1.0/&gt;.</span>

<span class="nb">from</span> <span class="nx">paste.deploy</span> <span class="k">import</span> <span class="nx">loadapp</span>
<span class="nb">from</span> <span class="nx">flup.server.fcgi</span> <span class="k">import</span> <span class="nx">WSGIServer</span>

<span class="n">CONFIG_PATH</span> <span class="o">=</span> <span class="o">\</span><span class="s1">&#39;&lt;/path/to/mediagoblin/paste.ini&gt;</span><span class="se">\&#39;</span><span class="s1"></span>

<span class="s1">import os</span>
<span class="s1">os.environ[</span><span class="se">\&#39;</span><span class="s1">CELERY_ALWAYS_EAGER</span><span class="se">\&#39;</span><span class="s1">] = </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"></span>

<span class="s1">def launch_fcgi():</span>
<span class="s1">    ccengine_wsgi_app = loadapp(</span><span class="se">\&#39;</span><span class="s1">config:</span><span class="se">\&#39;</span><span class="s1"> + CONFIG_PATH)</span>
<span class="s1">    WSGIServer(ccengine_wsgi_app).run()</span>


<span class="s1">if __name__ == </span><span class="se">\&#39;</span><span class="s1">__main__</span><span class="se">\&#39;</span><span class="s1">:</span>
<span class="s1">    launch_fcgi()</span>
</pre></div>
</td></tr></table>

<p>Das Script nun ausführbar machen:</p>
<div class="highlight"><pre><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">mediagoblin</span><span class="o">/</span><span class="n">mg</span><span class="p">.</span><span class="n">fcgi</span>
</pre></div>


<p>Und eine <code>.htaccess</code>-Datei erstellen:</p>
<div class="highlight"><pre><span class="n">RewriteEngine</span> <span class="n">On</span>
<span class="n">RewriteBase</span> <span class="o">/</span>
<span class="n">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="n">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="n">f</span>
<span class="n">RewriteRule</span> <span class="o">^</span><span class="p">(.</span><span class="o">*</span><span class="p">)</span><span class="err">$</span> <span class="n">mediagoblin</span><span class="o">/</span><span class="n">mg</span><span class="p">.</span><span class="n">fcgi</span><span class="o">/</span><span class="err">$</span><span class="mi">1</span> <span class="p">[</span><span class="n">QSA</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>

<span class="n">Options</span> <span class="o">+</span><span class="n">ExecCGI</span>
<span class="n">AddHandler</span> <span class="n">fcgid</span><span class="o">-</span><span class="n">script</span> <span class="p">.</span><span class="n">fcgi</span>
</pre></div>


<p>Das FastCGI-Depoyment ist nun bereits fertig!</p>
<h2>Service erstellen</h2>
<p>Wie üblich bei den Ubernauten wird nun noch ein Service erstellt.</p>
<p>Die Postgresinstallation hat <code>~/service</code> bereits erstellt - dies ist also bereits gemacht.</p>
<p>Bei mir sieht dann <code>~/etc/run-mediagoblin/run</code> folgendermassen aus:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nb">cd</span> /var/www/virtual/keks/mediagoblin.aurka.com/
<span class="nb">source </span>bin/activate
./lazyserver.sh --server-name<span class="o">=</span>fcgi <span class="nv">fcgi_host</span><span class="o">=</span>127.0.0.1 <span class="nv">fcgi_port</span><span class="o">=</span>&lt;Uberspace-Port-von-mir&gt;
</pre></div>
</td></tr></table>

<p>Nun muss einzig noch nach <code>~/service</code> gelinkt werden:
    ln -s ~/etc/run-mediagoblin/ ~/service/mediagoblin</p>
<p>Mediagoblin läuft nun als Service. Viel Spaß beim verwenden!</p>
<p>Wenn ihr zuerst ein Mediagoblin anschauen wollt. Hier ist mein <a href="http://mediagoblin.aurka.com" title="mediagoblin.aurka.com">Mediagoblin</a>.</p>
<p>Korrekturen, Bugfixes, etc. bitte an mich herantragen, damit ich die Doku verbessern/korrigieren kann.</p>
<h1>Useful links</h1>
<p><a href="http://www.linux-magazine.com/Online/Features/MediaGoblin" title="Linux Magazin">Linux Magazin mit einer Mediagoblin Installations-Anleitung</a></p>
<p><a href="http://mediagoblin.readthedocs.org/en/v0.5.1/siteadmin/deploying.html" title="Mediagoblin Wiki">Offizielles Mediagoblin Wiki</a></p>
<h1>Dankeschön</h1>
<p>An Christopher von der Ubernauten fürs weiterhelfen beim FastCGI deployment!</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Weitere Posts</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://aurka.com/online-hello-world.html" rel="bookmark"
                           title="Permalink to Online / Hello World">Online / Hello World</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
	Datum: 13.11.2013 |
        <!-- <abbr class="published" title="2013-11-13T00:00:00">
                13.11.2013
        </abbr> 

        <address class="vcard author">
                By <a class="url fn" href="http://aurka.com/author/janssen.html">janssen</a>
        </address>
 -->

Tags: <a href="http://aurka.com/tag/pelican.html">pelican</a>,<a href="http://aurka.com/tag/start.html">start</a>,<a href="http://aurka.com/tag/blog.html">blog</a>,<a href="http://aurka.com/tag/uberspace.html">uberspace</a>,<a href="http://aurka.com/tag/ubernauten.html">ubernauten</a>,<a href="http://aurka.com/tag/blogging.html">blogging</a>,</footer><!-- /.post-info -->                <p><img alt="woot" src="pictures/header_1.jpg" /></p>
<p>Die Seite ist Online!</p>
<p>Fazit:</p>
<ul>
<li>Design: Mehr oder weniger default-Pelican-Theme =&gt; boring</li>
<li>Inhalt: Eigentlich noch nichts =&gt; boring</li>
</ul>
<p>More to come.</p>
                <a class="readmore" href="http://aurka.com/online-hello-world.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
		<a href="https://uberspace.de/" alt="https://www.uberspace.de"><img src="http://www.aurka.com/pictures/uberspace.png" alt="Uberspace"></a>
		<p>Diese Asteroiden sind von Pinguinen besiedelt!</p>
		<p class="impressum">Ich mag nicht müssen ein doofes <a href="https://aurka.com/pages/impressum.html" alt="Iiiiiiii(h)mpressum">Imressum</a> zu schreiben</p>
                </address><!-- /#about -->

        </footer><!-- /#contentinfo -->

	<script type="text/javascript">
		var pkBaseURL = "piwik.aurka.com";
	var _paq = _paq || [];
	_paq.push(["trackPageView"]);
	_paq.push(["enableLinkTracking"]);
	(function() {
		var u=(("https:" == document.location.protocol) ? "https" : "http")+"://"+pkBaseURL+"/";
		_paq.push(["setTrackerUrl", u+"piwik.php"]);
		_paq.push(["setSiteId", "2"]);
		var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
		g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
	})();
	</script>
</body>
</html>